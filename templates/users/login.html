{% extends "layouts/base-fullscreen.html" %}
{% load static %}
{% block title %} Kirish {% endblock %}

{% block stylesheets %}{% endblock stylesheets %}

{% block body_class %} bg-soft {% endblock body_class %}

{% block content %}

<main>

    <section class="vh-lg-100 d-flex align-items-center">
        <div class="container">
            <div class="row justify-content-center form-bg-image"
                 data-background="{% static 'img/pages/tatu1.jpg' %}">
                <div class="col-12 d-flex align-items-center justify-content-center">
                    <div class="signin-inner my-3 my-lg-0 bg-white shadow-soft border rounded border-light p-4 p-lg-5 w-100 fmxw-500">

                        <div class="text-center text-md-center mb-4 mt-md-0">
                            <h1 class="mb-0 h4">
                                Toshkent axborat texnalogiyalari Universiteti Samarqand filiali
                            </h1>
                            <br/>
                            <p>
                                {% if msg %}
                                {{ msg | safe }}
                                {% else %}
                                <!-- Your credentials message -->
                                {% endif %}
                            </p>
                        </div>

                        <form method="post" action="{% url 'login' %}" class="mt-4" id="loginForm">
                            {% csrf_token %}
                            <div class="form-group mb-4">
                                <label for="email">Username</label>
                                <div class="input-group">
                                    <span class="input-group-text" id="basic-addon1"><span class="fas fa-user-circle"></span></span>
                                    <input class="form-control" type="username" name="username" placeholder="username">
                                </div>
                            </div>
                            <div class="form-group mb-4">
                                <label for="password">Parol</label>
                                <div class="input-group">
                                    <span class="input-group-text" id="basic-addon2"><span class="fas fa-unlock-alt"></span></span>
                                    <input class="form-control" type="password" name="password" placeholder="Parol">
                                </div>
                            </div>
                            <div class="form-group" id="captchaContainer" {% if form.captcha.field.required %} style="display: block;" {% else %} style="display: none;" {% endif %}>
                                <label for="{{ form.captcha.id_for_label }}">Captcha:</label>
                                {{ form.captcha }}
                            </div>
                            <br>
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="" id="defaultCheck5">
                                    <label class="form-check-label" for="defaultCheck5">
                                        Meni eslab qolish
                                    </label>
                                </div>
                                <div class="form-check">
                                    <a href="{% url 'register' %}" class="small text-right">Ro'yxatdan o'tish</a>
                                </div>
                            </div>
                            <button type="submit" name="login" class="btn btn-block btn-primary" onclick="loadCaptcha()">Kirish</button>
                            <div class="form-group">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <div class="form-check">
                                        <a href="" class="small text-right"></a>
                                    </div>
                                    <div class="form-check">
                                        <a href="" class="small text-right">Parolni unutdingizmi?</a>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>

</main>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    function loadCaptcha() {
        $.ajax({
            url: "{% url 'captcha_image' %}",
            success: function (data) {
                $("#captchaContainer").html(data);
                $("#captchaContainer").show();
            }
        });
    }

    $(document).ready(function () {
        loadCaptcha();
        $("#loginForm").submit(function (event) {
            var form = $(this);
            var username = form.find("input[name='username']").val();
            var password = form.find("input[name='password']").val();
            if (username && password) {
                $.ajax({
                    url: "{% url 'captcha_image' %}",
                    success: function (data) {
                        $("#captchaContainer").html(data);
                        $("#captchaContainer").show();
                    }
                });
            }
        });
    });
</script>

{% endblock content %}

{% block javascripts %}{% endblock javascripts %}
